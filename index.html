<!-- template.html -->
<html>
<head>
    <title>Personality Quiz</title>
    <script src="http://fb.me/react-with-addons-0.12.0.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
    <script src="modernizr.custom.96871.js"></script>
    <link rel="stylesheet" type="text/css" media="all" href="https://embed-13854.secondstreetapp.com/StaticContent/CSS/consumer_quiz.css">
    <style>
        html {
            background-color: #e5e5e5;
        }
        #ssFrontApp.ssPersonalityQuiz .ssQuestion .ssQuestionHeader .ssVerticalCenterTable {
            height: auto;
        }
        #ssFrontApp.ssPersonalityQuiz .ssButton.ssCalculateResultsButton {
            margin: 0 auto;
            display: block;
        }
        #ssFrontApp.ssPersonalityQuiz .ssQuiz {
            border-bottom: 0;
        }
    </style>
</head>
<body>
<div id="ssFrontApp" class="ssPersonalityQuiz"></div>
<script type="text/jsx">
    var Quiz = React.createClass({
        getInitialState: function() {
            return {data: []};
        },
        componentDidMount: function() {
            $.ajax({
                url: this.props.url,
                dataType: 'json',
                success: function(data) {
                    this.setState({data: data});
                }.bind(this),
                error: function(xhr, status, err) {
                    console.error(this.props.url, status, err.toString());
                }.bind(this)
            });
        },
        render: function(){
            var calculateResults = function(){
                console.log('Calculating Results');
            };
            return (

                <div className="ssAppContentArea ssLayoutMedium ssLayoutLarge ssLayoutDetermined">
                    <div className="ssQuiz">
                        <QuestionList data={this.state.data.questions}/>
                        <SubmitButton submit={calculateResults}/>
                    </div>
                </div>

            )
        }
    });

    var SubmitButton = React.createClass({
        render: function(){
            return (
                <button className="ssCalculateResultsButton ssButtonPrimary ssButton" onClick={this.props.submit}>Submit</button>
            )
        }
    });

    var QuestionList = React.createClass({

        render: function(){
            if(this.props.data){ //Handle if the data hasn't loaded yet
                var questionNodes = this.props.data.map(function (question) {
                    return (
                        <Question name={question.name} displayOrder={question.display_order} questionOptions={question.question_options}>
                        </Question>
                    );
                });
            }

            return (
                <div className="ssQuestions ssMainContent">
                    {questionNodes}
                </div>
            )
        }
    });
    var Question = React.createClass({
        render: function(){
            return (
                <div className="ssQuestion">
                    <div className="ssQuestionHeader">
                        <div className="ssVerticalCenterTable">
                            <h2 className="ssVerticalCenterTableRow ssQuestionTitle">
                                <span className="ssVerticalCenterTableData ssQuestionNumber">#{this.props.displayOrder}</span>
                                <span className="ssVerticalCenterTableData ssQuestionName">{this.props.name}</span>

                            </h2>
                        </div>
                    </div>
                    <QuestionOptionsList data={this.props.questionOptions} />
                </div>
            )
        }
    });
    var QuestionOptionsList = React.createClass({
        getInitialState: function() {
            return {picked: null};
        },
        render: function(){
            var setPicked = function(qo){
                this.setState({picked: qo});
            }.bind(this);
            var questionOptionNodes = this.props.data.map(function (questionOption) {
                if(this.state.picked && this.state.picked.props.id === questionOption.id){
                    return (
                        <QuestionOption id={questionOption.id} name={questionOption.name} displayOrder={questionOption.display_order} setPicked={setPicked} picked="true">
                        </QuestionOption>
                    )
                }
                return (
                        <QuestionOption id={questionOption.id} name={questionOption.name} displayOrder={questionOption.display_order} setPicked={setPicked}>
                        </QuestionOption>
                );
            }.bind(this));
            return (
                <div className="ssQuestionOptions">
                    <ul className="ssThumbnailGrid">
                        {questionOptionNodes}
                    </ul>
                </div>
            )
        }
    });
    var QuestionOption = React.createClass({
        render: function(){
            var cx = React.addons.classSet;
            var classes = cx({
                'ssThumbnailGridSquare': true,
                'picked': this.props.picked
            });
            return (
                <li className="ssThumbnailGridItem ssClickable ssThumbnailGridItemTextOnly" onClick={function(){this.props.setPicked(this)}.bind(this)}>
                    <a className={classes}>
                        <div className="ssVerticalCenterTableContainer">
                            <div className="ssVerticalCenterTable">
                                <div className="ssVerticalCenterTableRow">
                                    <div className="ssVerticalCenterTableData">
                                        {this.props.name}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
            )
        }
    });
    React.render(
        <Quiz url="questions.json" />,
        document.getElementById('ssFrontApp')
    );
</script>
</body>
</html>